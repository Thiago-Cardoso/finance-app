---
status: pending
parallelizable: false
blocked_by: []
---

<task_context>
<domain>frontend/ui/diagnostics</domain>
<type>investigation</type>
<scope>data_display</scope>
<complexity>low</complexity>
<dependencies>browser_dev_tools|api_calls|state_management</dependencies>
<unblocks>"2.0"</unblocks>
</task_context>

# Tarefa 1.0: Diagnóstico de Problemas de Listagem de Transações

## Visão Geral

Investigar e identificar a causa raiz do problema onde os valores das transações não estão sendo exibidos corretamente na tela de transações. Esta tarefa é de diagnóstico e deve identificar precisamente qual componente ou serviço está causando o problema.

## Requisitos

1. Identificar se o problema é no backend (API) ou frontend (renderização)
2. Verificar a estrutura de dados retornada pela API
3. Validar o fluxo de dados desde a API até o componente de exibição
4. Documentar todos os pontos de falha encontrados
5. Propor soluções específicas para correção

## Subtarefas

- [ ] 1.1 Verificar resposta da API /api/v1/transactions
  - Usar DevTools Network tab
  - Verificar estrutura do JSON retornado
  - Validar campos: amount, raw_amount, transaction_type
  - Confirmar se os valores numéricos estão corretos

- [ ] 1.2 Analisar TransactionSerializer no backend
  - Arquivo: `/backend/app/serializers/transaction_serializer.rb`
  - Verificar se raw_amount está sendo serializado
  - Confirmar formato de serialização do amount

- [ ] 1.3 Verificar hook useTransactions no frontend
  - Arquivo: `/frontend/src/hooks/useTransactions.ts`
  - Validar transformação de dados
  - Verificar se dados estão sendo corretamente mapeados

- [ ] 1.4 Analisar componente TransactionItem
  - Arquivo: `/frontend/src/components/transactions/TransactionItem.tsx`
  - Verificar linha 81: `formatCurrency(Math.abs(transaction.raw_amount))`
  - Confirmar se raw_amount existe e é numérico
  - Validar função formatCurrency

- [ ] 1.5 Testar função formatCurrency
  - Arquivo: `/frontend/src/lib/utils.ts`
  - Verificar implementação da função
  - Testar com valores undefined, null, 0
  - Validar formatação de números negativos

- [ ] 1.6 Verificar console do navegador
  - Procurar erros JavaScript
  - Verificar warnings relacionados a tipos
  - Analisar logs de requisições

- [ ] 1.7 Documentar achados
  - Criar documento com todos os problemas encontrados
  - Incluir screenshots ou logs relevantes
  - Propor solução para cada problema identificado

## Sequenciamento

- Bloqueado por: Nenhuma tarefa
- Desbloqueia: 2.0 (Correção de Valores na Listagem)
- Paralelizável: Não (deve ser executada primeiro)

## Detalhes de Implementação

### Ferramentas Necessárias

1. **Chrome/Firefox DevTools**
   - Network tab para inspecionar API
   - Console para verificar erros
   - React DevTools para inspecionar props/state

2. **Testes Manuais**
   - Criar uma transação de teste
   - Verificar exibição na lista
   - Testar diferentes tipos de transação (income, expense, transfer)

3. **Código a Investigar**

```typescript
// TransactionItem.tsx - Linha 81
formatCurrency(Math.abs(transaction.raw_amount))

// Verificar se raw_amount está definido
console.log('transaction.raw_amount:', transaction.raw_amount)
console.log('tipo:', typeof transaction.raw_amount)
```

### Cenários de Teste

1. **Teste 1: Transação Receita**
   - Criar receita de R$ 1.000,00
   - Verificar se aparece como "+R$ 1.000,00" em verde

2. **Teste 2: Transação Despesa**
   - Criar despesa de R$ 500,00
   - Verificar se aparece como "-R$ 500,00" em vermelho

3. **Teste 3: Transferência**
   - Criar transferência de R$ 250,00
   - Verificar se aparece valor em azul

4. **Teste 4: Valores Decimais**
   - Criar transação de R$ 99,99
   - Verificar formatação correta

### Possíveis Causas do Problema

1. **Backend não retorna raw_amount**
   - Serializer pode não incluir o campo
   - Verificar definição do serializer

2. **Frontend espera formato diferente**
   - Type definition pode não corresponder à resposta real
   - Verificar tipos em `/frontend/src/types/transaction.ts`

3. **Função formatCurrency com bug**
   - Pode não lidar com valores undefined
   - Pode ter problema com conversão de tipos

4. **Transformação de dados no hook**
   - useTransactions pode estar modificando estrutura
   - Verificar qualquer transformação intermediária

## Critérios de Sucesso

- [ ] Causa raiz do problema identificada
- [ ] Documentação completa do problema criada
- [ ] Solução proposta e validada tecnicamente
- [ ] Todos os cenários de teste executados
- [ ] Screenshots ou logs capturados como evidência
- [ ] Próximos passos claramente definidos para tarefa 2.0

## Arquivos Relevantes

### Backend
- `/backend/app/controllers/api/v1/transactions_controller.rb`
- `/backend/app/serializers/transaction_serializer.rb` (se existir)
- `/backend/app/models/transaction.rb`

### Frontend
- `/frontend/src/app/transactions/page.tsx`
- `/frontend/src/components/transactions/TransactionList.tsx`
- `/frontend/src/components/transactions/TransactionItem.tsx`
- `/frontend/src/hooks/useTransactions.ts`
- `/frontend/src/types/transaction.ts`
- `/frontend/src/lib/utils.ts`

## Entregáveis

1. **Documento de Diagnóstico** (Markdown)
   - Seção: Problema Identificado
   - Seção: Causa Raiz
   - Seção: Evidências (logs, screenshots)
   - Seção: Solução Proposta
   - Seção: Arquivos Afetados

2. **Checklist de Validação**
   - Lista de todos os testes executados
   - Resultados esperados vs obtidos

## Notas Técnicas

- Esta é uma tarefa de investigação, não de correção
- Não fazer alterações no código nesta etapa
- Focar em entender completamente o problema
- Documentar tudo para facilitar a correção
- Se múltiplos problemas forem encontrados, priorizar correções

## Tempo Estimado

30-45 minutos

## Próximos Passos

Após completar esta tarefa, os achados serão usados para:
- Tarefa 2.0: Implementar correções identificadas
- Priorizar correções baseado na severidade
