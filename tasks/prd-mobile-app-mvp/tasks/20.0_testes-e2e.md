# 20.0 - Testes E2E com Detox

**Sprint:** Sprint 4 (Semanas 9-10)
**Prioridade:** P0
**Estimativa:** 4 dias
**Paraleliz√°vel:** N√£o

---

## üìã Descri√ß√£o

Implementa testes end-to-end dos fluxos cr√≠ticos usando Detox: login/cadastro, criar transa√ß√£o e visualizar dashboard. Garante que funcionalidades principais funcionam de ponta a ponta em builds nativos.

Testes E2E previnem regress√µes em fluxos cr√≠ticos. Meta: 3-5 casos de teste principais, cobrindo caminho feliz e casos de erro.

---

## üéØ Objetivos

- [ ] Configurar Detox para iOS e Android
- [ ] Criar testes de login e cadastro
- [ ] Criar teste de cria√ß√£o de transa√ß√£o
- [ ] Criar teste de visualiza√ß√£o de dashboard
- [ ] Garantir testes rodando no CI
- [ ] Documentar como rodar testes E2E

---

## üìù Subtarefas

### 20.1 - Setup do Detox
**Estimativa:** L
**Tipo:** Setup

**Comandos:**
```bash
npm install --save-dev detox jest
npx detox init
```

**Arquivos:**
- `.detoxrc.js`
- `e2e/jest.config.js`

**Checklist:**
- [ ] Detox instalado
- [ ] Configura√ß√£o iOS
- [ ] Configura√ß√£o Android
- [ ] Scripts npm criados

### 20.2 - Build de Teste
**Estimativa:** M
**Tipo:** Setup

**Comandos:**
```bash
detox build --configuration ios.sim.debug
detox build --configuration android.emu.debug
```

**Checklist:**
- [ ] Build iOS para simulador
- [ ] Build Android para emulador
- [ ] Configura√ß√µes de debug

### 20.3 - Teste de Login
**Estimativa:** M
**Tipo:** Teste

**Arquivos:**
- `e2e/auth.e2e.ts`

**C√≥digo:**
```typescript
describe('Login Flow', () => {
  beforeAll(async () => {
    await device.launchApp();
  });

  it('should login successfully', async () => {
    await element(by.id('email-input')).typeText('user@test.com');
    await element(by.id('password-input')).typeText('password123');
    await element(by.id('login-button')).tap();
    
    await waitFor(element(by.id('dashboard-screen')))
      .toBeVisible()
      .withTimeout(5000);
  });

  it('should show error for invalid credentials', async () => {
    await element(by.id('email-input')).typeText('wrong@test.com');
    await element(by.id('password-input')).typeText('wrongpass');
    await element(by.id('login-button')).tap();
    
    await expect(element(by.text('Credenciais inv√°lidas'))).toBeVisible();
  });
});
```

**Checklist:**
- [ ] Teste de login sucesso
- [ ] Teste de login com erro
- [ ] Teste de cadastro
- [ ] Teste de logout

### 20.4 - Teste de Transa√ß√£o
**Estimativa:** M
**Tipo:** Teste

**Arquivos:**
- `e2e/transactions.e2e.ts`

**Checklist:**
- [ ] Teste de criar transa√ß√£o
- [ ] Teste de editar transa√ß√£o
- [ ] Teste de deletar transa√ß√£o
- [ ] Valida√ß√£o de campos obrigat√≥rios

### 20.5 - Teste de Dashboard
**Estimativa:** M
**Tipo:** Teste

**Arquivos:**
- `e2e/dashboard.e2e.ts`

**Checklist:**
- [ ] Teste de visualiza√ß√£o do dashboard
- [ ] Teste de pull-to-refresh
- [ ] Teste de navega√ß√£o entre tabs

### 20.6 - Test IDs em Componentes
**Estimativa:** M
**Tipo:** Desenvolvimento

**Checklist:**
- [ ] Adicionar testID em todos os elementos cr√≠ticos
- [ ] Documentar conven√ß√£o de test IDs
- [ ] Revisar componentes existentes

### 20.7 - Mock de API para E2E
**Estimativa:** M
**Tipo:** Setup

**Checklist:**
- [ ] Mock server para testes
- [ ] Fixtures de dados
- [ ] Reset de estado entre testes

### 20.8 - CI/CD para E2E
**Estimativa:** M
**Tipo:** Setup

**Arquivos:**
- `.github/workflows/e2e.yml`

**Checklist:**
- [ ] Workflow de E2E no GitHub Actions
- [ ] Rodar em push para main
- [ ] Upload de screenshots de falhas

### 20.9 - Documenta√ß√£o
**Estimativa:** S
**Tipo:** Documenta√ß√£o

**Arquivos:**
- `e2e/README.md`

**Checklist:**
- [ ] Como rodar testes localmente
- [ ] Como escrever novos testes
- [ ] Troubleshooting comum

---

## üîó Depend√™ncias

**Bloqueia:** 21.0
**Bloqueado por:** 8.0, 12.0
**Paralelo com:** Nenhuma

---

## ‚úÖ Crit√©rios de Sucesso

- [ ] 3-5 testes E2E cr√≠ticos passando
- [ ] Testes rodando em iOS e Android
- [ ] CI rodando testes E2E
- [ ] Documenta√ß√£o completa
- [ ] Screenshots de falhas capturados
- [ ] Tempo de execu√ß√£o < 10 minutos
- [ ] Code review aprovado

---

## üìö Refer√™ncias

- [PRD - Se√ß√£o 7.1](../prd.md#71-estrat√©gia-de-testes)
- [Detox Docs](https://wix.github.io/Detox/)
- [Detox with Expo](https://docs.expo.dev/build-reference/e2e-tests/)

---

## üè∑Ô∏è Tags

`#e2e` `#testing` `#detox` `#quality` `#critical`

---

## üìå Notas Importantes

- Detox requer build nativo (n√£o funciona com Expo Go)
- Usar EAS Build para gerar builds de teste
- Test IDs devem ser √∫nicos e descritivos
- Rodar testes em simulador/emulador (n√£o device real)
- Mock de API para testes determin√≠sticos
- Screenshots autom√°ticos em falhas
- Tempo limite: 5s por a√ß√£o
- Reset de estado entre testes

---

**Criado em:** 2025-11-10
**Atualizado em:** 2025-11-10
**Status:** ‚è≥ N√£o iniciada
