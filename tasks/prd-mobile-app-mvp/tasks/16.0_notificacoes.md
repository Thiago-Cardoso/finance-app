# 16.0 - Sistema de NotificaÃ§Ãµes

**Sprint:** Sprint 3 (Semana 8)
**Prioridade:** P2
**Estimativa:** 2 dias
**ParalelizÃ¡vel:** Sim

---

## ğŸ“‹ DescriÃ§Ã£o

Implementa sistema de notificaÃ§Ãµes push locais (nÃ£o requer backend complexo). Inclui notificaÃ§Ã£o diÃ¡ria lembrando de registrar gastos (opt-in) e notificaÃ§Ã£o quando orÃ§amento atinge 80%. UsuÃ¡rio controla permissÃµes e horÃ¡rios.

NotificaÃ§Ãµes aumentam engagement mas devem ser discretas e Ãºteis. No MVP, apenas locais (Expo Notifications).

---

## ğŸ¯ Objetivos

- [ ] Configurar Expo Notifications
- [ ] Implementar notificaÃ§Ã£o diÃ¡ria
- [ ] Adicionar notificaÃ§Ã£o de orÃ§amento
- [ ] Criar tela de configuraÃ§Ãµes de notificaÃ§Ãµes
- [ ] Solicitar permissÃµes do usuÃ¡rio
- [ ] Agendar notificaÃ§Ãµes

---

## ğŸ“ Subtarefas

### 16.1 - Setup Expo Notifications
**Estimativa:** S
**Tipo:** Setup

**Comandos:**
```bash
npm install expo-notifications
```

**Arquivos:**
- `app.json`

**Checklist:**
- [ ] Expo Notifications instalado
- [ ] PermissÃµes configuradas no app.json
- [ ] iOS/Android capabilities

### 16.2 - Service de NotificaÃ§Ãµes
**Estimativa:** M
**Tipo:** Desenvolvimento

**Arquivos:**
- `src/shared/services/notifications/notifications.service.ts`

**CÃ³digo:**
```typescript
import * as Notifications from 'expo-notifications';

export async function requestPermissions() {
  const { status } = await Notifications.requestPermissionsAsync();
  return status === 'granted';
}

export async function scheduleDaily Reminder(hour: number = 20) {
  await Notifications.scheduleNotificationAsync({
    content: {
      title: 'NÃ£o se esqueÃ§a!',
      body: 'Registre seus gastos de hoje',
      data: { type: 'daily_reminder' },
    },
    trigger: {
      hour,
      minute: 0,
      repeats: true,
    },
  });
}

export async function cancelAllNotifications() {
  await Notifications.cancelAllScheduledNotificationsAsync();
}
```

**Checklist:**
- [ ] requestPermissions
- [ ] scheduleDailyReminder
- [ ] scheduleBudgetAlert
- [ ] cancelAllNotifications
- [ ] Testes unitÃ¡rios

### 16.3 - NotificaÃ§Ã£o DiÃ¡ria
**Estimativa:** M
**Tipo:** Desenvolvimento

**Checklist:**
- [ ] Agendamento diÃ¡rio
- [ ] HorÃ¡rio configurÃ¡vel (padrÃ£o 20h)
- [ ] TÃ­tulo e mensagem amigÃ¡veis
- [ ] Deep link para TransactionForm

### 16.4 - NotificaÃ§Ã£o de OrÃ§amento
**Estimativa:** M
**Tipo:** Desenvolvimento

**Checklist:**
- [ ] Trigger quando atingir 80% do orÃ§amento
- [ ] Mensagem especÃ­fica por categoria
- [ ] Deep link para Budget Detail
- [ ] NÃ£o repetir no mesmo dia

### 16.5 - ConfiguraÃ§Ãµes de NotificaÃ§Ãµes
**Estimativa:** M
**Tipo:** Desenvolvimento

**Arquivos:**
- `src/app/profile/NotificationSettings.view.tsx`

**Checklist:**
- [ ] Toggle notificaÃ§Ãµes ativas
- [ ] Toggle lembretes diÃ¡rios
- [ ] Seletor de horÃ¡rio
- [ ] Toggle alertas de orÃ§amento
- [ ] Salvar preferÃªncias

### 16.6 - Hook useNotifications
**Estimativa:** S
**Tipo:** Desenvolvimento

**Arquivos:**
- `src/shared/hooks/useNotifications.ts`

**Checklist:**
- [ ] Gerenciar permissÃµes
- [ ] Agendar/cancelar notificaÃ§Ãµes
- [ ] Verificar status de permissÃ£o

### 16.7 - Notification Handler
**Estimativa:** M
**Tipo:** Desenvolvimento

**Arquivos:**
- `src/App.tsx` (adicionar handler)

**CÃ³digo:**
```typescript
Notifications.setNotificationHandler({
  handleNotification: async () => ({
    shouldShowAlert: true,
    shouldPlaySound: true,
    shouldSetBadge: false,
  }),
});
```

**Checklist:**
- [ ] Handler de notificaÃ§Ãµes
- [ ] Deep linking ao tocar
- [ ] NavegaÃ§Ã£o correta

### 16.8 - IntegraÃ§Ã£o com OrÃ§amentos
**Estimativa:** S
**Tipo:** Desenvolvimento

**Checklist:**
- [ ] Verificar orÃ§amentos ao atualizar
- [ ] Disparar notificaÃ§Ã£o se threshold atingido
- [ ] Marcar como notificado (nÃ£o repetir)

### 16.9 - Testes
**Estimativa:** M
**Tipo:** Teste

**Checklist:**
- [ ] Testes do service
- [ ] Testes do hook
- [ ] Mock de Expo Notifications
- [ ] Cobertura > 70%

---

## ğŸ”— DependÃªncias

**Bloqueia:** Nenhuma
**Bloqueado por:** 8.0, 12.0
**Paralelo com:** 15.0, 17.0

---

## âœ… CritÃ©rios de Sucesso

- [ ] NotificaÃ§Ãµes locais funcionando
- [ ] PermissÃµes solicitadas corretamente
- [ ] Lembretes diÃ¡rios agendando
- [ ] Alertas de orÃ§amento disparando
- [ ] ConfiguraÃ§Ãµes salvando preferÃªncias
- [ ] Deep linking funcionando
- [ ] Cobertura de testes: 70%
- [ ] Code review aprovado

---

## ğŸ“š ReferÃªncias

- [PRD - RF08](../prd.md#rf08---notificaÃ§Ãµes-push-bÃ¡sicas)
- [Expo Notifications](https://docs.expo.dev/versions/latest/sdk/notifications/)

---

## ğŸ·ï¸ Tags

`#notifications` `#engagement` `#push` `#medium-priority`

---

## ğŸ“Œ Notas Importantes

- Apenas notificaÃ§Ãµes locais no MVP (nÃ£o push remotas)
- UsuÃ¡rio deve ter controle total (opt-in)
- HorÃ¡rio padrÃ£o: 20h
- NÃ£o ser intrusivo (mÃ¡ximo 1 notificaÃ§Ã£o por dia de lembrete)
- iOS: permissÃµes obrigatÃ³rias
- Android: permissÃµes automÃ¡ticas (mas boas prÃ¡ticas pedir)
- Testar em dispositivos reais (notificaÃ§Ãµes nÃ£o funcionam em simulador iOS)

---

**Criado em:** 2025-11-10
**Atualizado em:** 2025-11-10
**Status:** â³ NÃ£o iniciada
